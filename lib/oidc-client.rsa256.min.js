!function e(t,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var n=r();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(this,(function(){return(()=>{var e={742:(e,t)=>{"use strict";t.byteLength=function r(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function n(e){var t,r,n=l(e),i=n[0],o=n[1],u=new a(function c(e,t,r){return 3*(t+r)/4-r}(0,i,o)),d=0,h=o>0?i-4:i;for(r=0;r<h;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],u[d++]=t>>16&255,u[d++]=t>>8&255,u[d++]=255&t;2===o&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,u[d++]=255&t);1===o&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,u[d++]=t>>8&255,u[d++]=255&t);return u},t.fromByteArray=function i(e){for(var t,r=e.length,n=r%3,i=[],s=16383,a=0,u=r-n;a<u;a+=s)i.push(h(e,a,a+s>u?u:a+s));1===n?(t=e[r-1],i.push(o[t>>2]+o[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],i.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return i.join("")};for(var o=[],s=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,d=u.length;c<d;++c)o[c]=u[c],s[u.charCodeAt(c)]=c;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function h(e,t,r){for(var n,i,s=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(o[(i=n)>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return s.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},249:function(e,t,r){var n;e.exports=(n=n||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==r.g&&r.g.crypto&&(n=r.g.crypto),!n)try{n=r(480)}catch(e){}var i=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),s={},a=s.lib={},u=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=u.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var a=0;a<i;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(i());return new c.init(t,e)}}),d=s.enc={},l=d.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},h=d.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},p=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},f=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,a=o/(4*s),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,d=e.min(4*u,o);if(u){for(var l=0;l<u;l+=s)this._doProcessBlock(i,l);r=i.splice(0,u),n.sigBytes-=d}return new c.init(r,d)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(a.Hasher=f.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}}),s.algo={});return s}(Math),n)},153:function(e,t,r){var n;e.exports=(n=r(249),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,s=t.algo,a=[],u=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)t(n)&&(i<8&&(a[i]=r(e.pow(n,.5))),u[i]=r(e.pow(n,1/3)),i++),n++}();var c=[],d=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],d=r[5],l=r[6],h=r[7],p=0;p<64;p++){if(p<16)c[p]=0|e[t+p];else{var f=c[p-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,_=c[p-2],v=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;c[p]=g+c[p-7]+v+c[p-16]}var m=n&i^n&o^i&o,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),k=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&l)+u[p]+c[p];h=l,l=d,d=a,a=s+k|0,s=o,o=i,i=n,n=k+(y+m)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+d|0,r[6]=r[6]+l|0,r[7]=r[7]+h|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=e.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(d),t.HmacSHA256=o._createHmacHelper(d)}(Math),n.SHA256)},77:function(e,t){(function(){var t;function r(e,t,r){null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function n(){return new r(null)}var i="undefined"!=typeof navigator;i&&"Microsoft Internet Explorer"==navigator.appName?(r.prototype.am=function o(e,t,r,n,i,s){for(var a=32767&t,u=t>>15;--s>=0;){var c=32767&this[e],d=this[e++]>>15,l=u*c+d*a;i=((c=a*c+((32767&l)<<15)+r[n]+(1073741823&i))>>>30)+(l>>>15)+u*d+(i>>>30),r[n++]=1073741823&c}return i},t=30):i&&"Netscape"!=navigator.appName?(r.prototype.am=function s(e,t,r,n,i,o){for(;--o>=0;){var s=t*this[e++]+r[n]+i;i=Math.floor(s/67108864),r[n++]=67108863&s}return i},t=26):(r.prototype.am=function a(e,t,r,n,i,o){for(var s=16383&t,a=t>>14;--o>=0;){var u=16383&this[e],c=this[e++]>>14,d=a*u+c*s;i=((u=s*u+((16383&d)<<14)+r[n]+i)>>28)+(d>>14)+a*c,r[n++]=268435455&u}return i},t=28),r.prototype.DB=t,r.prototype.DM=(1<<t)-1,r.prototype.DV=1<<t;r.prototype.FV=Math.pow(2,52),r.prototype.F1=52-t,r.prototype.F2=2*t-52;var u,c,d=new Array;for(u="0".charCodeAt(0),c=0;c<=9;++c)d[u++]=c;for(u="a".charCodeAt(0),c=10;c<36;++c)d[u++]=c;for(u="A".charCodeAt(0),c=10;c<36;++c)d[u++]=c;function l(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function h(e,t){var r=d[e.charCodeAt(t)];return null==r?-1:r}function p(e){var t=n();return t.fromInt(e),t}function f(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function g(e){this.m=e}function _(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function v(e,t){return e&t}function m(e,t){return e|t}function y(e,t){return e^t}function k(e,t){return e&~t}function b(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function S(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function w(){}function T(e){return e}function P(e){this.r2=n(),this.q3=n(),r.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}g.prototype.convert=function R(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},g.prototype.revert=function E(e){return e},g.prototype.reduce=function U(e){e.divRemTo(this.m,null,e)},g.prototype.mulTo=function C(e,t,r){e.multiplyTo(t,r),this.reduce(r)},g.prototype.sqrTo=function x(e,t){e.squareTo(t),this.reduce(t)},_.prototype.convert=function I(e){var t=n();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(r.ZERO)>0&&this.m.subTo(t,t),t},_.prototype.revert=function O(e){var t=n();return e.copyTo(t),this.reduce(t),t},_.prototype.reduce=function M(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},_.prototype.mulTo=function j(e,t,r){e.multiplyTo(t,r),this.reduce(r)},_.prototype.sqrTo=function A(e,t){e.squareTo(t),this.reduce(t)},r.prototype.copyTo=function N(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},r.prototype.fromInt=function q(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},r.prototype.fromString=function J(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var i=e.length,o=!1,s=0;--i>=0;){var a=8==n?255&e[i]:h(e,i);a<0?"-"==e.charAt(i)&&(o=!0):(o=!1,0==s?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),o&&r.ZERO.subTo(this,this)},r.prototype.clamp=function B(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},r.prototype.dlShiftTo=function F(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s},r.prototype.drShiftTo=function V(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},r.prototype.lShiftTo=function D(e,t){var r,n=e%this.DB,i=this.DB-n,o=(1<<i)-1,s=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t[r+s+1]=this[r]>>i|a,a=(this[r]&o)<<n;for(r=s-1;r>=0;--r)t[r]=0;t[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()},r.prototype.rShiftTo=function W(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,o=(1<<n)-1;t[0]=this[r]>>n;for(var s=r+1;s<this.t;++s)t[s-r-1]|=(this[s]&o)<<i,t[s-r]=this[s]>>n;n>0&&(t[this.t-r-1]|=(this.s&o)<<i),t.t=this.t-r,t.clamp()}},r.prototype.subTo=function H(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()},r.prototype.multiplyTo=function L(e,t){var n=this.abs(),i=e.abs(),o=n.t;for(t.t=o+i.t;--o>=0;)t[o]=0;for(o=0;o<i.t;++o)t[o+n.t]=n.am(0,i[o],t,o,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&r.ZERO.subTo(t,t)},r.prototype.squareTo=function z(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},r.prototype.divRemTo=function K(e,t,i){var o=e.abs();if(!(o.t<=0)){var s=this.abs();if(s.t<o.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=n());var a=n(),u=this.s,c=e.s,d=this.DB-f(o[o.t-1]);d>0?(o.lShiftTo(d,a),s.lShiftTo(d,i)):(o.copyTo(a),s.copyTo(i));var l=a.t,h=a[l-1];if(0!=h){var p=h*(1<<this.F1)+(l>1?a[l-2]>>this.F2:0),g=this.FV/p,_=(1<<this.F1)/p,v=1<<this.F2,m=i.t,y=m-l,k=null==t?n():t;for(a.dlShiftTo(y,k),i.compareTo(k)>=0&&(i[i.t++]=1,i.subTo(k,i)),r.ONE.dlShiftTo(l,k),k.subTo(a,a);a.t<l;)a[a.t++]=0;for(;--y>=0;){var b=i[--m]==h?this.DM:Math.floor(i[m]*g+(i[m-1]+v)*_);if((i[m]+=a.am(0,b,i,y,0,l))<b)for(a.dlShiftTo(y,k),i.subTo(k,i);i[m]<--b;)i.subTo(k,i)}null!=t&&(i.drShiftTo(l,t),u!=c&&r.ZERO.subTo(t,t)),i.t=l,i.clamp(),d>0&&i.rShiftTo(d,i),u<0&&r.ZERO.subTo(i,i)}}},r.prototype.invDigit=function Q(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},r.prototype.isEven=function X(){return 0==(this.t>0?1&this[0]:this.s)},r.prototype.exp=function Z(e,t){if(e>4294967295||e<1)return r.ONE;var i=n(),o=n(),s=t.convert(this),a=f(e)-1;for(s.copyTo(i);--a>=0;)if(t.sqrTo(i,o),(e&1<<a)>0)t.mulTo(o,s,i);else{var u=i;i=o,o=u}return t.revert(i)},r.prototype.toString=function G(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,o="",s=this.t,a=this.DB-s*this.DB%t;if(s-- >0)for(a<this.DB&&(r=this[s]>>a)>0&&(i=!0,o=l(r));s>=0;)a<t?(r=(this[s]&(1<<a)-1)<<t-a,r|=this[--s]>>(a+=this.DB-t)):(r=this[s]>>(a-=t)&n,a<=0&&(a+=this.DB,--s)),r>0&&(i=!0),i&&(o+=l(r));return i?o:"0"},r.prototype.negate=function Y(){var e=n();return r.ZERO.subTo(this,e),e},r.prototype.abs=function $(){return this.s<0?this.negate():this},r.prototype.compareTo=function ee(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0},r.prototype.bitLength=function te(){return this.t<=0?0:this.DB*(this.t-1)+f(this[this.t-1]^this.s&this.DM)},r.prototype.mod=function re(e){var t=n();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(r.ZERO)>0&&e.subTo(t,t),t},r.prototype.modPowInt=function ne(e,t){var r;return r=e<256||t.isEven()?new g(t):new _(t),this.exp(e,r)},r.ZERO=p(0),r.ONE=p(1),w.prototype.convert=T,w.prototype.revert=T,w.prototype.mulTo=function ie(e,t,r){e.multiplyTo(t,r)},w.prototype.sqrTo=function oe(e,t){e.squareTo(t)},P.prototype.convert=function se(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=n();return e.copyTo(t),this.reduce(t),t},P.prototype.revert=function ae(e){return e},P.prototype.reduce=function ue(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},P.prototype.mulTo=function ce(e,t,r){e.multiplyTo(t,r),this.reduce(r)},P.prototype.sqrTo=function de(e,t){e.squareTo(t),this.reduce(t)};var le,he,pe,fe=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ge=(1<<26)/fe[fe.length-1];function _e(){!function e(t){he[pe++]^=255&t,he[pe++]^=t>>8&255,he[pe++]^=t>>16&255,he[pe++]^=t>>24&255,pe>=yt&&(pe-=yt)}((new Date).getTime())}if(r.prototype.chunkSize=function ve(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},r.prototype.toRadix=function me(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),i=p(r),o=n(),s=n(),a="";for(this.divRemTo(i,o,s);o.signum()>0;)a=(r+s.intValue()).toString(e).substr(1)+a,o.divRemTo(i,o,s);return s.intValue().toString(e)+a},r.prototype.fromRadix=function ye(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),i=Math.pow(t,n),o=!1,s=0,a=0,u=0;u<e.length;++u){var c=h(e,u);c<0?"-"==e.charAt(u)&&0==this.signum()&&(o=!0):(a=t*a+c,++s>=n&&(this.dMultiply(i),this.dAddOffset(a,0),s=0,a=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(a,0)),o&&r.ZERO.subTo(this,this)},r.prototype.fromNumber=function ke(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(r.ONE.shiftLeft(e-1),m,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(r.ONE.shiftLeft(e-1),this);else{var i=new Array,o=7&e;i.length=1+(e>>3),t.nextBytes(i),o>0?i[0]&=(1<<o)-1:i[0]=0,this.fromString(i,256)}},r.prototype.bitwiseTo=function be(e,t,r){var n,i,o=Math.min(e.t,this.t);for(n=0;n<o;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){for(i=e.s&this.DM,n=o;n<this.t;++n)r[n]=t(this[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=o;n<e.t;++n)r[n]=t(i,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},r.prototype.changeBit=function Se(e,t){var n=r.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},r.prototype.addTo=function we(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()},r.prototype.dMultiply=function Te(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},r.prototype.dAddOffset=function Pe(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},r.prototype.multiplyLowerTo=function Re(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;i>0;)r[--i]=0;for(n=r.t-this.t;i<n;++i)r[i+this.t]=this.am(0,e[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e[i],r,i,0,t-i);r.clamp()},r.prototype.multiplyUpperTo=function Ee(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},r.prototype.modInt=function Ue(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this[n])%e;return r},r.prototype.millerRabin=function Ce(e){var t=this.subtract(r.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var o=t.shiftRight(i);(e=e+1>>1)>fe.length&&(e=fe.length);for(var s=n(),a=0;a<e;++a){s.fromInt(fe[Math.floor(Math.random()*fe.length)]);var u=s.modPow(o,this);if(0!=u.compareTo(r.ONE)&&0!=u.compareTo(t)){for(var c=1;c++<i&&0!=u.compareTo(t);)if(0==(u=u.modPowInt(2,this)).compareTo(r.ONE))return!1;if(0!=u.compareTo(t))return!1}}return!0},r.prototype.clone=function xe(){var e=n();return this.copyTo(e),e},r.prototype.intValue=function Ie(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},r.prototype.byteValue=function Oe(){return 0==this.t?this.s:this[0]<<24>>24},r.prototype.shortValue=function Me(){return 0==this.t?this.s:this[0]<<16>>16},r.prototype.signum=function je(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},r.prototype.toByteArray=function Ae(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t},r.prototype.equals=function Ne(e){return 0==this.compareTo(e)},r.prototype.min=function qe(e){return this.compareTo(e)<0?this:e},r.prototype.max=function Je(e){return this.compareTo(e)>0?this:e},r.prototype.and=function Be(e){var t=n();return this.bitwiseTo(e,v,t),t},r.prototype.or=function Fe(e){var t=n();return this.bitwiseTo(e,m,t),t},r.prototype.xor=function Ve(e){var t=n();return this.bitwiseTo(e,y,t),t},r.prototype.andNot=function De(e){var t=n();return this.bitwiseTo(e,k,t),t},r.prototype.not=function We(){for(var e=n(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},r.prototype.shiftLeft=function He(e){var t=n();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},r.prototype.shiftRight=function Le(e){var t=n();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},r.prototype.getLowestSetBit=function ze(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+b(this[e]);return this.s<0?this.t*this.DB:-1},r.prototype.bitCount=function Ke(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=S(this[r]^t);return e},r.prototype.testBit=function Qe(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},r.prototype.setBit=function Xe(e){return this.changeBit(e,m)},r.prototype.clearBit=function Ze(e){return this.changeBit(e,k)},r.prototype.flipBit=function Ge(e){return this.changeBit(e,y)},r.prototype.add=function Ye(e){var t=n();return this.addTo(e,t),t},r.prototype.subtract=function $e(e){var t=n();return this.subTo(e,t),t},r.prototype.multiply=function et(e){var t=n();return this.multiplyTo(e,t),t},r.prototype.divide=function tt(e){var t=n();return this.divRemTo(e,t,null),t},r.prototype.remainder=function rt(e){var t=n();return this.divRemTo(e,null,t),t},r.prototype.divideAndRemainder=function nt(e){var t=n(),r=n();return this.divRemTo(e,t,r),new Array(t,r)},r.prototype.modPow=function it(e,t){var r,i,o=e.bitLength(),s=p(1);if(o<=0)return s;r=o<18?1:o<48?3:o<144?4:o<768?5:6,i=o<8?new g(t):t.isEven()?new P(t):new _(t);var a=new Array,u=3,c=r-1,d=(1<<r)-1;if(a[1]=i.convert(this),r>1){var l=n();for(i.sqrTo(a[1],l);u<=d;)a[u]=n(),i.mulTo(l,a[u-2],a[u]),u+=2}var h,v,m=e.t-1,y=!0,k=n();for(o=f(e[m])-1;m>=0;){for(o>=c?h=e[m]>>o-c&d:(h=(e[m]&(1<<o+1)-1)<<c-o,m>0&&(h|=e[m-1]>>this.DB+o-c)),u=r;0==(1&h);)h>>=1,--u;if((o-=u)<0&&(o+=this.DB,--m),y)a[h].copyTo(s),y=!1;else{for(;u>1;)i.sqrTo(s,k),i.sqrTo(k,s),u-=2;u>0?i.sqrTo(s,k):(v=s,s=k,k=v),i.mulTo(k,a[h],s)}for(;m>=0&&0==(e[m]&1<<o);)i.sqrTo(s,k),v=s,s=k,k=v,--o<0&&(o=this.DB-1,--m)}return i.revert(s)},r.prototype.modInverse=function ot(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return r.ZERO;for(var n=e.clone(),i=this.clone(),o=p(1),s=p(0),a=p(0),u=p(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(e,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&u.isEven()||(a.addTo(this,a),u.subTo(e,u)),a.rShiftTo(1,a)):u.isEven()||u.subTo(e,u),u.rShiftTo(1,u);n.compareTo(i)>=0?(n.subTo(i,n),t&&o.subTo(a,o),s.subTo(u,s)):(i.subTo(n,i),t&&a.subTo(o,a),u.subTo(s,u))}return 0!=i.compareTo(r.ONE)?r.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u},r.prototype.pow=function st(e){return this.exp(e,new w)},r.prototype.gcd=function at(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),o=r.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),o>0&&(t.rShiftTo(o,t),r.rShiftTo(o,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return o>0&&r.lShiftTo(o,r),r},r.prototype.isProbablePrime=function ut(e){var t,r=this.abs();if(1==r.t&&r[0]<=fe[fe.length-1]){for(t=0;t<fe.length;++t)if(r[0]==fe[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<fe.length;){for(var n=fe[t],i=t+1;i<fe.length&&n<ge;)n*=fe[i++];for(n=r.modInt(n);t<i;)if(n%fe[t++]==0)return!1}return r.millerRabin(e)},r.prototype.square=function ct(){var e=n();return this.squareTo(e),e},r.prototype.Barrett=P,null==he){var dt;if(he=new Array,pe=0,"undefined"!=typeof window&&window.crypto)if(window.crypto.getRandomValues){var lt=new Uint8Array(32);for(window.crypto.getRandomValues(lt),dt=0;dt<32;++dt)he[pe++]=lt[dt]}else if("Netscape"==navigator.appName&&navigator.appVersion<"5"){var ht=window.crypto.random(32);for(dt=0;dt<ht.length;++dt)he[pe++]=255&ht.charCodeAt(dt)}for(;pe<yt;)dt=Math.floor(65536*Math.random()),he[pe++]=dt>>>8,he[pe++]=255&dt;pe=0,_e()}function pt(){if(null==le){for(_e(),(le=function e(){return new gt}()).init(he),pe=0;pe<he.length;++pe)he[pe]=0;pe=0}return le.next()}function ft(){}function gt(){this.i=0,this.j=0,this.S=new Array}ft.prototype.nextBytes=function _t(e){var t;for(t=0;t<e.length;++t)e[t]=pt()},gt.prototype.init=function vt(e){var t,r,n;for(t=0;t<256;++t)this.S[t]=t;for(r=0,t=0;t<256;++t)r=r+this.S[t]+e[t%e.length]&255,n=this.S[t],this.S[t]=this.S[r],this.S[r]=n;this.i=0,this.j=0},gt.prototype.next=function mt(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var yt=256;e.exports={default:r,BigInteger:r,SecureRandom:ft}}).call(this)},480:()=>{}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.r(n),r.d(n,{default:()=>Ze});var t,i,o={debug:function e(){},info:function e(){},warn:function e(){},error:function e(){}},s=function(){function r(){}return r.reset=function e(){i=3,t=o},r.debug=function e(){if(i>=4){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.debug.apply(t,Array.from(n))}},r.info=function e(){if(i>=3){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.info.apply(t,Array.from(n))}},r.warn=function e(){if(i>=2){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.warn.apply(t,Array.from(n))}},r.error=function e(){if(i>=1){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.error.apply(t,Array.from(n))}},function n(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(r,null,[{key:"NONE",get:function e(){return 0}},{key:"ERROR",get:function e(){return 1}},{key:"WARN",get:function e(){return 2}},{key:"INFO",get:function e(){return 3}},{key:"DEBUG",get:function e(){return 4}},{key:"level",get:function e(){return i},set:function e(t){if(!(0<=t&&t<=4))throw new Error("Invalid log level");i=t}},{key:"logger",get:function e(){return t},set:function e(r){if(!r.debug&&r.info&&(r.debug=r.info),!(r.debug&&r.info&&r.warn&&r.error))throw new Error("Invalid logger");t=r}}]),r}();s.reset();var a=function(){function e(){}return e.prototype.getEpochTime=function e(){return Promise.resolve(Date.now()/1e3|0)},e}();function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c={setInterval:function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return setInterval(e,t)})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return clearInterval(e)}))},d=!1,l=null,h=function(){function e(){}return e._testing=function e(){d=!0},e.setXMLHttpRequest=function e(t){l=t},function t(e,r,n){return r&&u(e.prototype,r),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,null,[{key:"location",get:function e(){if(!d)return location}},{key:"localStorage",get:function e(){if(!d&&"undefined"!=typeof window)return localStorage}},{key:"sessionStorage",get:function e(){if(!d&&"undefined"!=typeof window)return sessionStorage}},{key:"XMLHttpRequest",get:function e(){if(!d&&"undefined"!=typeof window)return l||XMLHttpRequest}},{key:"timer",get:function e(){if(!d)return c}}]),e}(),p=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.prefix,r=void 0===t?"oidc.":t,n=e.store,i=void 0===n?h.localStorage:n;this._store=i,this._prefix=r}var t=e.prototype;return t.set=function e(t,r){return s.debug("WebStorageStateStore.set",t),t=this._prefix+t,this._store.setItem(t,r),Promise.resolve()},t.get=function e(t){s.debug("WebStorageStateStore.get",t),t=this._prefix+t;var r=this._store.getItem(t);return Promise.resolve(r)},t.remove=function e(t){s.debug("WebStorageStateStore.remove",t),t=this._prefix+t;var r=this._store.getItem(t);return this._store.removeItem(t),Promise.resolve(r)},t.getAllKeys=function e(){s.debug("WebStorageStateStore.getAllKeys");for(var t=[],r=0;r<this._store.length;r++){var n=this._store.key(r);0===n.indexOf(this._prefix)&&t.push(n.substr(this._prefix.length))}return Promise.resolve(t)},e}(),f=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.XMLHttpRequest,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e&&Array.isArray(e)?this._contentTypes=e.slice():this._contentTypes=[],this._contentTypes.push("application/json"),r&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=t,this._jwtHandler=r}var t=e.prototype;return t.getJson=function e(t,r){var n=this;if(!t)throw s.error("JsonService.getJson: No url passed"),new Error("url");return s.debug("JsonService.getJson, url: ",t),new Promise((function(e,i){var o=new n._XMLHttpRequest;o.open("GET",t);var a=n._contentTypes,u=n._jwtHandler;o.onload=function(){if(s.debug("JsonService.getJson: HTTP response received, status",o.status),200===o.status){var r=o.getResponseHeader("Content-Type");if(r){var n=a.find((function(e){if(r.startsWith(e))return!0}));if("application/jwt"==n)return void u(o).then(e,i);if(n)try{return void e(JSON.parse(o.responseText))}catch(e){return s.error("JsonService.getJson: Error parsing JSON response",e.message),void i(e)}}i(Error("Invalid response Content-Type: "+r+", from URL: "+t))}else i(Error(o.statusText+" ("+o.status+")"))},o.onerror=function(){s.error("JsonService.getJson: network error"),i(Error("Network Error"))},r&&(s.debug("JsonService.getJson: token passed, setting Authorization header"),o.setRequestHeader("Authorization","Bearer "+r)),o.send()}))},t.postForm=function e(t,r,n){var i=this;if(!t)throw s.error("JsonService.postForm: No url passed"),new Error("url");return s.debug("JsonService.postForm, url: ",t),new Promise((function(e,o){var a=new i._XMLHttpRequest;a.open("POST",t);var u=i._contentTypes;a.onload=function(){if(s.debug("JsonService.postForm: HTTP response received, status",a.status),200!==a.status){if(400===a.status)if(n=a.getResponseHeader("Content-Type"))if(u.find((function(e){if(n.startsWith(e))return!0})))try{var r=JSON.parse(a.responseText);if(r&&r.error)return s.error("JsonService.postForm: Error from server: ",r.error),void o(new Error(r.error))}catch(e){return s.error("JsonService.postForm: Error parsing JSON response",e.message),void o(e)}o(Error(a.statusText+" ("+a.status+")"))}else{var n;if((n=a.getResponseHeader("Content-Type"))&&u.find((function(e){if(n.startsWith(e))return!0})))try{return void e(JSON.parse(a.responseText))}catch(e){return s.error("JsonService.postForm: Error parsing JSON response",e.message),void o(e)}o(Error("Invalid response Content-Type: "+n+", from URL: "+t))}},a.onerror=function(){s.error("JsonService.postForm: network error"),o(Error("Network Error"))};var c="";for(var d in r){var l=r[d];l&&(c.length>0&&(c+="&"),c+=encodeURIComponent(d),c+="=",c+=encodeURIComponent(l))}a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),void 0!==n&&a.setRequestHeader("Authorization","Basic "+btoa(n)),a.send(c)}))},e}();function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _=".well-known/openid-configuration",v=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f;if(!e)throw s.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=e,this._jsonService=new t(["application/jwk-set+json"])}var t=e.prototype;return t.resetSigningKeys=function e(){this._settings=this._settings||{},this._settings.signingKeys=void 0},t.getMetadata=function e(){var t=this;return this._settings.metadata?(s.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(s.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then((function(e){s.debug("MetadataService.getMetadata: json received");var r=t._settings.metadataSeed||{};return t._settings.metadata=Object.assign({},r,e),t._settings.metadata}))):(s.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},t.getIssuer=function e(){return this._getMetadataProperty("issuer")},t.getAuthorizationEndpoint=function e(){return this._getMetadataProperty("authorization_endpoint")},t.getUserInfoEndpoint=function e(){return this._getMetadataProperty("userinfo_endpoint")},t.getTokenEndpoint=function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._getMetadataProperty("token_endpoint",t)},t.getCheckSessionIframe=function e(){return this._getMetadataProperty("check_session_iframe",!0)},t.getEndSessionEndpoint=function e(){return this._getMetadataProperty("end_session_endpoint",!0)},t.getRevocationEndpoint=function e(){return this._getMetadataProperty("revocation_endpoint",!0)},t.getKeysEndpoint=function e(){return this._getMetadataProperty("jwks_uri",!0)},t._getMetadataProperty=function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s.debug("MetadataService.getMetadataProperty for: "+t),this.getMetadata().then((function(e){if(s.debug("MetadataService.getMetadataProperty: metadata recieved"),void 0===e[t]){if(!0===r)return void s.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+t);throw s.error("MetadataService.getMetadataProperty: Metadata does not contain property "+t),new Error("Metadata does not contain property "+t)}return e[t]}))},t.getSigningKeys=function e(){var t=this;return this._settings.signingKeys?(s.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then((function(e){return s.debug("MetadataService.getSigningKeys: jwks_uri received",e),t._jsonService.getJson(e).then((function(e){if(s.debug("MetadataService.getSigningKeys: key set received",e),!e.keys)throw s.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return t._settings.signingKeys=e.keys,t._settings.signingKeys}))}))},function r(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"metadataUrl",get:function e(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(_)<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=_))),this._metadataUrl}}]),e}(),m=r(77),y=r.n(m),k=r(153),b=r.n(k),S=r(742),w=y().BigInteger,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P={b64tohex:function e(t){var r,n,i="",o=0;for(r=0;r<t.length&&"="!==t.charAt(r);++r){var s=T.indexOf(t.charAt(r));s<0||(0===o?(i+=String.fromCharCode(s>>2),n=3&s,o=1):1===o?(i+=String.fromCharCode(n<<2|s>>4),n=15&s,o=2):2===o?(i+=String.fromCharCode(n),i+=String.fromCharCode(s>>2),n=3&s,o=3):(i+=String.fromCharCode(n<<2|s>>4),i+=String.fromCharCode(15&s),o=0))}return 1===o&&(i+=String.fromCharCode(n<<2)),i},hexToBase64:function e(t){var r,n,i="";for(r=0;r+3<=t.length;r+=3)n=parseInt(t.substring(r,r+3),16),i+=T.charAt(n>>6)+T.charAt(63&n);for(r+1===t.length?(n=parseInt(t.substring(r,r+1),16),i+=T.charAt(n<<2)):r+2===t.length&&(n=parseInt(t.substring(r,r+2),16),i+=T.charAt(n>>2)+T.charAt((3&n)<<4)),"=";(3&i.length)>0;)i+="=";return i},padding:function e(t){var r=t.length%4;return 0===r?t:t+new Array(1+(4-r)).join("=")},byteArrayToHex:function e(t){for(var r="",n=0;n<t.length;n++){var i=t[n].toString(16);r+=2===i.length?i:"0"+i}return r},decodeToHEX:function e(t){return P.byteArrayToHex(S.toByteArray(P.padding(t)))},base64ToBase64Url:function e(t){return t=(t=(t=t.replace(/=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")},urlDecode:function e(t){return t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g," "),atob(t)}},R={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},E={sha256:b(),SHA256:b()};function U(e,t){if(this.n=null,this.e=0,!(null!=e&&null!=t&&e.length>0&&t.length>0))throw new Error("Invalid key data");this.n=new w(e,16),this.e=parseInt(t,16)}U.prototype.verify=function(e,t){t=(t=P.decodeToHEX(t)).replace(/[^0-9a-f]|[\s\n]]/gi,"");var r=new w(t,16);if(r.bitLength()>this.n.bitLength())throw new Error("Signature does not match with the key modulus.");var n=function i(e){for(var t in R){var r=R[t],n=r.length;if(e.substring(0,n)===r)return{alg:t,hash:e.substring(n)}}return[]}(r.modPowInt(this.e,this.n).toString(16).replace(/^1f+00/,""));if(0===n.length)return!1;if(!E.hasOwnProperty(n.alg))throw new Error("Hashing algorithm is not supported.");var o=E[n.alg](e).toString();return n.hash===o};var C=["RS256"],x={JWS:{parse:function e(t){var r,n,i=t.split(".");if(3===i.length){try{r=JSON.parse(P.urlDecode(i[0])),n=JSON.parse(P.urlDecode(i[1]))}catch(e){return new Error("Token header or payload is not valid JSON")}return{headerObj:r,payloadObj:n}}},verify:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];n.forEach((function(e){if(-1===C.indexOf(e))throw new Error("Invalid signing algorithm: "+e)}));var e=new U(r.n,r.e),i=t.split("."),o=[i[0],i[1]].join(".");return e.verify(o,i[2])}}};var I=function M(e){var t=e.jws,r=e.KeyUtil,n=e.X509,i=e.crypto,o=e.hextob64u,a=e.b64tohex,u=e.AllowedSigningAlgs;return function(){function e(){}return e.parseJwt=function e(r){s.debug("JoseUtil.parseJwt");try{var n=t.JWS.parse(r);return{header:n.headerObj,payload:n.payloadObj}}catch(e){s.error(e)}},e.validateJwt=function t(i,o,u,c,d,l,h){s.debug("JoseUtil.validateJwt");try{if("RSA"===o.kty)if(o.e&&o.n)o=r.getKey(o);else{if(!o.x5c||!o.x5c.length)return s.error("JoseUtil.validateJwt: RSA key missing key material",o),Promise.reject(new Error("RSA key missing key material"));var p=a(o.x5c[0]);o=n.getPublicKeyFromCertHex(p)}else{if("EC"!==o.kty)return s.error("JoseUtil.validateJwt: Unsupported key type",o&&o.kty),Promise.reject(new Error("Unsupported key type: "+o&&o.kty));if(!(o.crv&&o.x&&o.y))return s.error("JoseUtil.validateJwt: EC key missing key material",o),Promise.reject(new Error("EC key missing key material"));o=r.getKey(o)}return e._validateJwt(i,o,u,c,d,l,h)}catch(e){return s.error(e&&e.message||e),Promise.reject("JWT validation failed")}},e.validateJwtAttributes=function t(r,n,i,o,a,u){o||(o=0),a||(a=parseInt(Date.now()/1e3));var c=e.parseJwt(r).payload;if(!c.iss)return s.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(c.iss!==n)return s.error("JoseUtil._validateJwt: Invalid issuer in token",c.iss),Promise.reject(new Error("Invalid issuer in token: "+c.iss));if(!c.aud)return s.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(c.aud===i||Array.isArray(c.aud)&&c.aud.indexOf(i)>=0))return s.error("JoseUtil._validateJwt: Invalid audience in token",c.aud),Promise.reject(new Error("Invalid audience in token: "+c.aud));if(c.azp&&c.azp!==i)return s.error("JoseUtil._validateJwt: Invalid azp in token",c.azp),Promise.reject(new Error("Invalid azp in token: "+c.azp));if(!u){var d=a+o,l=a-o;if(!c.iat)return s.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(d<c.iat)return s.error("JoseUtil._validateJwt: iat is in the future",c.iat),Promise.reject(new Error("iat is in the future: "+c.iat));if(c.nbf&&d<c.nbf)return s.error("JoseUtil._validateJwt: nbf is in the future",c.nbf),Promise.reject(new Error("nbf is in the future: "+c.nbf));if(!c.exp)return s.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(c.exp<l)return s.error("JoseUtil._validateJwt: exp is in the past",c.exp),Promise.reject(new Error("exp is in the past:"+c.exp))}return Promise.resolve(c)},e._validateJwt=function r(n,i,o,a,c,d,l){return e.validateJwtAttributes(n,o,a,c,d,l).then((function(e){try{return t.JWS.verify(n,i,u)?e:(s.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(e){return s.error(e&&e.message||e),Promise.reject(new Error("signature validation failed"))}}))},e.hashString=function e(t,r){try{return i.Util.hashString(t,r)}catch(e){s.error(e)}},e.hexToBase64Url=function e(t){try{return o(t)}catch(e){s.error(e)}},e}()}({jws:x,KeyUtil:{getKey:function e(t){return"RSA"===t.kty?{e:P.decodeToHEX(t.e),n:P.decodeToHEX(t.n)}:null}},X509:{getPublicKeyFromCertPEM:function e(){throw new Error("Not implemented. Use the full oidc-client library if you need support for X509.")}},crypto:{Util:{hashString:function e(t,r){return(0,E[r])(t).toString()}}},hextob64u:function O(e){return e.length%2==1&&(e="0"+e),P.base64ToBase64Url(P.hexToBase64(e))},b64tohex:P.b64tohex,AllowedSigningAlgs:C}),j=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:I;if(!e)throw s.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new r(this._settings),this._joseUtil=n}var t=e.prototype;return t.getClaims=function e(t){var r=this;return t?this._metadataService.getUserInfoEndpoint().then((function(e){return s.debug("UserInfoService.getClaims: received userinfo url",e),r._jsonService.getJson(e,t).then((function(e){return s.debug("UserInfoService.getClaims: claims received",e),e}))})):(s.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},t._getClaimsFromJwt=function e(t){var r=this;try{var n=this._joseUtil.parseJwt(t.responseText);if(!n||!n.header||!n.payload)return s.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",n),Promise.reject(new Error("Failed to parse id_token"));var i,o=n.header.kid;switch(this._settings.userInfoJwtIssuer){case"OP":i=this._metadataService.getIssuer();break;case"ANY":i=Promise.resolve(n.payload.iss);break;default:i=Promise.resolve(this._settings.userInfoJwtIssuer)}return i.then((function(e){return s.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+e),r._metadataService.getSigningKeys().then((function(i){if(!i)return s.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));var a;if(s.debug("UserInfoService._getClaimsFromJwt: Received signing keys"),o)a=i.filter((function(e){return e.kid===o}))[0];else{if((i=r._filterByAlg(i,n.header.alg)).length>1)return s.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));a=i[0]}if(!a)return s.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var u=r._settings.client_id,c=r._settings.clockSkew;return s.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",c),r._joseUtil.validateJwt(t.responseText,a,e,u,c,void 0,!0).then((function(){return s.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),n.payload}))}))}))}catch(e){return s.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",e.message),void reject(e)}},t._filterByAlg=function e(t,r){var n=null;if(r.startsWith("RS"))n="RSA";else if(r.startsWith("PS"))n="PS";else{if(!r.startsWith("ES"))return s.debug("UserInfoService._filterByAlg: alg not supported: ",r),[];n="EC"}return s.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",n),t=t.filter((function(e){return e.kty===n})),s.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",n,t.length),t},e}(),A=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;if(!e)throw s.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t,this._metadataService=new r(this._settings)}var t=e.prototype;return t.exchangeCode=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(r=Object.assign({},r)).grant_type=r.grant_type||"authorization_code",r.client_id=r.client_id||this._settings.client_id,r.client_secret=r.client_secret||this._settings.client_secret,r.redirect_uri=r.redirect_uri||this._settings.redirect_uri;var n=void 0,i=r._client_authentication||this._settings._client_authentication;return delete r._client_authentication,r.code?r.redirect_uri?r.code_verifier?r.client_id?r.client_secret||"client_secret_basic"!=i?("client_secret_basic"==i&&(n=r.client_id+":"+r.client_secret,delete r.client_id,delete r.client_secret),this._metadataService.getTokenEndpoint(!1).then((function(e){return s.debug("TokenClient.exchangeCode: Received token endpoint"),t._jsonService.postForm(e,r,n).then((function(e){return s.debug("TokenClient.exchangeCode: response received"),e}))}))):(s.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(s.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(s.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(s.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(s.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},t.exchangeRefreshToken=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(r=Object.assign({},r)).grant_type=r.grant_type||"refresh_token",r.client_id=r.client_id||this._settings.client_id,r.client_secret=r.client_secret||this._settings.client_secret;var n=void 0,i=r._client_authentication||this._settings._client_authentication;return delete r._client_authentication,r.refresh_token?r.client_id?("client_secret_basic"==i&&(n=r.client_id+":"+r.client_secret,delete r.client_id,delete r.client_secret),this._metadataService.getTokenEndpoint(!1).then((function(e){return s.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),t._jsonService.postForm(e,r,n).then((function(e){return s.debug("TokenClient.exchangeRefreshToken: response received"),e}))}))):(s.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(s.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},e}();function N(e){var t="function"==typeof Map?new Map:void 0;return N=function e(r){if(null===r||!function n(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,i)}function i(){return q(r,arguments,F(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),B(i,r)},N(e)}function q(e,t,r){return q=J()?Reflect.construct:function e(t,r,n){var i=[null];i.push.apply(i,r);var o=new(Function.bind.apply(t,i));return n&&B(o,n.prototype),o},q.apply(null,arguments)}function J(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function B(e,t){return B=Object.setPrototypeOf||function e(t,r){return t.__proto__=r,t},B(e,t)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)},F(e)}var V=function(e){function t(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.error,i=r.error_description,o=r.error_uri,a=r.state,u=r.session_state;if(!n)throw s.error("No error passed to ErrorResponse"),new Error("error");return(t=e.call(this,i||n)||this).name="ErrorResponse",t.error=n,t.error_description=i,t.error_uri=o,t.state=a,t.session_state=u,t}return function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,B(e,t)}(t,e),t}(N(Error));function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}var W=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"],H=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:I,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A;if(!e)throw s.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=e,this._metadataService=new t(this._settings),this._userInfoService=new r(this._settings),this._joseUtil=n,this._tokenClient=new i(this._settings)}var t=e.prototype;return t.validateSigninResponse=function e(t,r){var n=this;return s.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(t,r).then((function(e){return s.debug("ResponseValidator.validateSigninResponse: state processed"),n._validateTokens(t,e).then((function(e){return s.debug("ResponseValidator.validateSigninResponse: tokens validated"),n._processClaims(t,e).then((function(e){return s.debug("ResponseValidator.validateSigninResponse: claims processed"),e}))}))}))},t.validateSignoutResponse=function e(t,r){return t.id!==r.state?(s.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(s.debug("ResponseValidator.validateSignoutResponse: state validated"),r.state=t.data,r.error?(s.warn("ResponseValidator.validateSignoutResponse: Response was error",r.error),Promise.reject(new V(r))):Promise.resolve(r))},t._processSigninParams=function e(t,r){if(t.id!==r.state)return s.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!t.client_id)return s.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!t.authority)return s.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==t.authority)return s.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=t.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==t.client_id)return s.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=t.client_id;return s.debug("ResponseValidator._processSigninParams: state validated"),r.state=t.data,r.error?(s.warn("ResponseValidator._processSigninParams: Response was error",r.error),Promise.reject(new V(r))):t.nonce&&!r.id_token?(s.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!t.nonce&&r.id_token?(s.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):t.code_verifier&&!r.code?(s.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!t.code_verifier&&r.code?(s.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(r.scope||(r.scope=t.scope),Promise.resolve(r))},t._processClaims=function e(t,r){var n=this;if(r.isOpenIdConnect){if(s.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),r.profile=this._filterProtocolClaims(r.profile),!0!==t.skipUserInfo&&this._settings.loadUserInfo&&r.access_token)return s.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(r.access_token).then((function(e){return s.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),e.sub!==r.profile.sub?(s.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(r.profile=n._mergeClaims(r.profile,e),s.debug("ResponseValidator._processClaims: user info claims received, updated profile:",r.profile),r)}));s.debug("ResponseValidator._processClaims: not loading user info")}else s.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(r)},t._mergeClaims=function e(t,r){var n=Object.assign({},t);for(var i in r){var o=r[i];Array.isArray(o)||(o=[o]);for(var s=0;s<o.length;s++){var a=o[s];n[i]?Array.isArray(n[i])?n[i].indexOf(a)<0&&n[i].push(a):n[i]!==a&&("object"===D(a)&&this._settings.mergeClaims?n[i]=this._mergeClaims(n[i],a):n[i]=[n[i],a]):n[i]=a}}return n},t._filterProtocolClaims=function e(t){s.debug("ResponseValidator._filterProtocolClaims, incoming claims:",t);var r=Object.assign({},t);return this._settings._filterProtocolClaims?(W.forEach((function(e){delete r[e]})),s.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",r)):s.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),r},t._validateTokens=function e(t,r){return r.code?(s.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(t,r)):r.id_token?r.access_token?(s.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(t,r)):(s.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(t,r)):(s.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(r))},t._processCode=function e(t,r){var n=this,i={client_id:t.client_id,client_secret:t.client_secret,code:r.code,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier};return t.extraTokenParams&&"object"===D(t.extraTokenParams)&&Object.assign(i,t.extraTokenParams),this._tokenClient.exchangeCode(i).then((function(e){for(var i in e)r[i]=e[i];return r.id_token?(s.debug("ResponseValidator._processCode: token response successful, processing id_token"),n._validateIdTokenAttributes(t,r)):(s.debug("ResponseValidator._processCode: token response successful, returning response"),r)}))},t._validateIdTokenAttributes=function e(t,r){var n=this;return this._metadataService.getIssuer().then((function(e){var i=t.client_id,o=n._settings.clockSkew;return s.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",o),n._settings.getEpochTime().then((function(a){return n._joseUtil.validateJwtAttributes(r.id_token,e,i,o,a).then((function(e){return t.nonce&&t.nonce!==e.nonce?(s.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):e.sub?(r.profile=e,r):(s.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))}))}))}))},t._validateIdTokenAndAccessToken=function e(t,r){var n=this;return this._validateIdToken(t,r).then((function(e){return n._validateAccessToken(e)}))},t._getSigningKeyForJwt=function e(t){var r=this;return this._metadataService.getSigningKeys().then((function(e){var n,i=t.header.kid;if(!e)return s.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));if(s.debug("ResponseValidator._validateIdToken: Received signing keys"),i)n=e.filter((function(e){return e.kid===i}))[0];else{if((e=r._filterByAlg(e,t.header.alg)).length>1)return s.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));n=e[0]}return Promise.resolve(n)}))},t._getSigningKeyForJwtWithSingleRetry=function e(t){var r=this;return this._getSigningKeyForJwt(t).then((function(e){return e?Promise.resolve(e):(r._metadataService.resetSigningKeys(),r._getSigningKeyForJwt(t))}))},t._validateIdToken=function e(t,r){var n=this;if(!t.nonce)return s.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var i=this._joseUtil.parseJwt(r.id_token);return i&&i.header&&i.payload?t.nonce!==i.payload.nonce?(s.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then((function(e){return s.debug("ResponseValidator._validateIdToken: Received issuer"),n._getSigningKeyForJwtWithSingleRetry(i).then((function(o){if(!o)return s.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var a=t.client_id,u=n._settings.clockSkew;return s.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",u),n._joseUtil.validateJwt(r.id_token,o,e,a,u).then((function(){return s.debug("ResponseValidator._validateIdToken: JWT validation successful"),i.payload.sub?(r.profile=i.payload,r):(s.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))}))}))})):(s.error("ResponseValidator._validateIdToken: Failed to parse id_token",i),Promise.reject(new Error("Failed to parse id_token")))},t._filterByAlg=function e(t,r){var n=null;if(r.startsWith("RS"))n="RSA";else if(r.startsWith("PS"))n="PS";else{if(!r.startsWith("ES"))return s.debug("ResponseValidator._filterByAlg: alg not supported: ",r),[];n="EC"}return s.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",n),t=t.filter((function(e){return e.kty===n})),s.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",n,t.length),t},t._validateAccessToken=function e(t){if(!t.profile)return s.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!t.profile.at_hash)return s.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!t.id_token)return s.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var r=this._joseUtil.parseJwt(t.id_token);if(!r||!r.header)return s.error("ResponseValidator._validateAccessToken: Failed to parse id_token",r),Promise.reject(new Error("Failed to parse id_token"));var n=r.header.alg;if(!n||5!==n.length)return s.error("ResponseValidator._validateAccessToken: Unsupported alg:",n),Promise.reject(new Error("Unsupported alg: "+n));var i=n.substr(2,3);if(!i)return s.error("ResponseValidator._validateAccessToken: Unsupported alg:",n,i),Promise.reject(new Error("Unsupported alg: "+n));if(256!==(i=parseInt(i))&&384!==i&&512!==i)return s.error("ResponseValidator._validateAccessToken: Unsupported alg:",n,i),Promise.reject(new Error("Unsupported alg: "+n));var o="sha"+i,a=this._joseUtil.hashString(t.access_token,o);if(!a)return s.error("ResponseValidator._validateAccessToken: access_token hash failed:",o),Promise.reject(new Error("Failed to validate at_hash"));var u=a.substr(0,a.length/2),c=this._joseUtil.hexToBase64Url(u);return c!==t.profile.at_hash?(s.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",c,t.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(s.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(t))},e}();function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var K=".well-known/openid-configuration",Q="id_token",X="openid",Z="client_secret_post",G=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.authority,r=e.metadataUrl,n=e.metadata,i=e.signingKeys,o=e.metadataSeed,s=e.client_id,u=e.client_secret,c=e.response_type,d=void 0===c?Q:c,l=e.scope,h=void 0===l?X:l,f=e.redirect_uri,g=e.post_logout_redirect_uri,_=e.client_authentication,m=void 0===_?Z:_,y=e.prompt,k=e.display,b=e.max_age,S=e.ui_locales,w=e.acr_values,T=e.resource,P=e.response_mode,R=e.filterProtocolClaims,E=void 0===R||R,U=e.loadUserInfo,C=void 0===U||U,x=e.staleStateAge,I=void 0===x?900:x,O=e.clockSkew,M=void 0===O?300:O,j=e.clockService,A=void 0===j?new a:j,N=e.userInfoJwtIssuer,q=void 0===N?"OP":N,J=e.mergeClaims,B=void 0!==J&&J,F=e.stateStore,V=void 0===F?new p:F,D=e.ResponseValidatorCtor,W=void 0===D?H:D,z=e.MetadataServiceCtor,K=void 0===z?v:z,G=e.extraQueryParams,Y=void 0===G?{}:G,$=e.extraTokenParams,ee=void 0===$?{}:$;this._authority=t,this._metadataUrl=r,this._metadata=n,this._metadataSeed=o,this._signingKeys=i,this._client_id=s,this._client_secret=u,this._response_type=d,this._scope=h,this._redirect_uri=f,this._post_logout_redirect_uri=g,this._client_authentication=m,this._prompt=y,this._display=k,this._max_age=b,this._ui_locales=S,this._acr_values=w,this._resource=T,this._response_mode=P,this._filterProtocolClaims=!!E,this._loadUserInfo=!!C,this._staleStateAge=I,this._clockSkew=M,this._clockService=A,this._userInfoJwtIssuer=q,this._mergeClaims=!!B,this._stateStore=V,this._validator=new W(this),this._metadataService=new K(this),this._extraQueryParams="object"===L(Y)?Y:{},this._extraTokenParams="object"===L(ee)?ee:{}}return e.prototype.getEpochTime=function e(){return this._clockService.getEpochTime()},function t(e,r,n){return r&&z(e.prototype,r),n&&z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"client_id",get:function e(){return this._client_id},set:function e(t){if(this._client_id)throw s.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=t}},{key:"client_secret",get:function e(){return this._client_secret}},{key:"response_type",get:function e(){return this._response_type}},{key:"scope",get:function e(){return this._scope}},{key:"redirect_uri",get:function e(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function e(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function e(){return this._client_authentication}},{key:"prompt",get:function e(){return this._prompt}},{key:"display",get:function e(){return this._display}},{key:"max_age",get:function e(){return this._max_age}},{key:"ui_locales",get:function e(){return this._ui_locales}},{key:"acr_values",get:function e(){return this._acr_values}},{key:"resource",get:function e(){return this._resource}},{key:"response_mode",get:function e(){return this._response_mode}},{key:"authority",get:function e(){return this._authority},set:function e(t){if(this._authority)throw s.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=t}},{key:"metadataUrl",get:function e(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(K)<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=K)),this._metadataUrl}},{key:"metadata",get:function e(){return this._metadata},set:function e(t){this._metadata=t}},{key:"metadataSeed",get:function e(){return this._metadataSeed},set:function e(t){this._metadataSeed=t}},{key:"signingKeys",get:function e(){return this._signingKeys},set:function e(t){this._signingKeys=t}},{key:"filterProtocolClaims",get:function e(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function e(){return this._loadUserInfo}},{key:"staleStateAge",get:function e(){return this._staleStateAge}},{key:"clockSkew",get:function e(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function e(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function e(){return this._mergeClaims}},{key:"stateStore",get:function e(){return this._stateStore}},{key:"validator",get:function e(){return this._validator}},{key:"metadataService",get:function e(){return this._metadataService}},{key:"extraQueryParams",get:function e(){return this._extraQueryParams},set:function e(t){"object"===L(t)?this._extraQueryParams=t:this._extraQueryParams={}}},{key:"extraTokenParams",get:function e(){return this._extraTokenParams},set:function e(t){"object"===L(t)?this._extraTokenParams=t:this._extraTokenParams={}}}]),e}(),Y=function(){function e(){}return e.addQueryParam=function e(t,r,n){return t.indexOf("?")<0&&(t+="?"),"?"!==t[t.length-1]&&(t+="&"),t+=encodeURIComponent(r),t+="=",t+=encodeURIComponent(n)},e.parseUrlFragment=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h;"string"!=typeof t&&(t=n.location.href);var i=t.lastIndexOf(r);i>=0&&(t=t.substr(i+1)),"?"===r&&(i=t.indexOf("#"))>=0&&(t=t.substr(0,i));for(var o,a={},u=/([^&=]+)=([^&]*)/g,c=0;o=u.exec(t);)if(a[decodeURIComponent(o[1])]=decodeURIComponent(o[2].replace(/\+/g," ")),c++>50)return s.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",t),{error:"Response exceeded expected number of parameters"};for(var d in a)return a;return{}},e}(),$="undefined"!=typeof window?window.crypto||window.msCrypto:null;function ee(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^$.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}function te(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^16*Math.random()>>e/4).toString(16)}))}function re(){return("undefined"!=$&&null!==$&&void 0!==$.getRandomValues?ee:te)().replace(/-/g,"")}function ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ie=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,r=e.data,n=e.created,i=e.request_type;this._id=t||re(),this._data=r,this._created="number"==typeof n&&n>0?n:parseInt(Date.now()/1e3),this._request_type=i}return e.prototype.toStorageString=function e(){return s.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},e.fromStorageString=function t(r){return s.debug("State.fromStorageString"),new e(JSON.parse(r))},e.clearStaleState=function t(r,n){var i=Date.now()/1e3-n;return r.getAllKeys().then((function(t){s.debug("State.clearStaleState: got keys",t);for(var n=[],o=function o(a){var c=t[a];u=r.get(c).then((function(t){var n=!1;if(t)try{var o=e.fromStorageString(t);s.debug("State.clearStaleState: got item from key: ",c,o.created),o.created<=i&&(n=!0)}catch(e){s.error("State.clearStaleState: Error parsing state for key",c,e.message),n=!0}else s.debug("State.clearStaleState: no item in storage for key: ",c),n=!0;if(n)return s.debug("State.clearStaleState: removed item for key: ",c),r.remove(c)})),n.push(u)},a=0;a<t.length;a++){var u;o(a)}return s.debug("State.clearStaleState: waiting on promise count:",n.length),Promise.all(n)}))},function t(e,r,n){return r&&ne(e.prototype,r),n&&ne(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"id",get:function e(){return this._id}},{key:"data",get:function e(){return this._data}},{key:"created",get:function e(){return this._created}},{key:"request_type",get:function e(){return this._request_type}}]),e}();function oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function se(e,t){return se=Object.setPrototypeOf||function e(t,r){return t.__proto__=r,t},se(e,t)}var ae=function(e){function t(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.nonce,i=r.authority,o=r.client_id,s=r.redirect_uri,a=r.code_verifier,u=r.response_mode,c=r.client_secret,d=r.scope,l=r.extraTokenParams,h=r.skipUserInfo;if(t=e.call(this,arguments[0])||this,!0===n?t._nonce=re():n&&(t._nonce=n),!0===a?t._code_verifier=re()+re()+re():a&&(t._code_verifier=a),t.code_verifier){var p=I.hashString(t.code_verifier,"SHA256");t._code_challenge=I.hexToBase64Url(p)}return t._redirect_uri=s,t._authority=i,t._client_id=o,t._response_mode=u,t._client_secret=c,t._scope=d,t._extraTokenParams=l,t._skipUserInfo=h,t}return function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,se(e,t)}(t,e),t.prototype.toStorageString=function e(){return s.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},t.fromStorageString=function e(r){return s.debug("SigninState.fromStorageString"),new t(JSON.parse(r))},function n(e,t,r){return t&&oe(e.prototype,t),r&&oe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"nonce",get:function e(){return this._nonce}},{key:"authority",get:function e(){return this._authority}},{key:"client_id",get:function e(){return this._client_id}},{key:"redirect_uri",get:function e(){return this._redirect_uri}},{key:"code_verifier",get:function e(){return this._code_verifier}},{key:"code_challenge",get:function e(){return this._code_challenge}},{key:"response_mode",get:function e(){return this._response_mode}},{key:"client_secret",get:function e(){return this._client_secret}},{key:"scope",get:function e(){return this._scope}},{key:"extraTokenParams",get:function e(){return this._extraTokenParams}},{key:"skipUserInfo",get:function e(){return this._skipUserInfo}}]),t}(ie),ue=function(){function e(t){var r=t.url,n=t.client_id,i=t.redirect_uri,o=t.response_type,a=t.scope,u=t.authority,c=t.data,d=t.prompt,l=t.display,h=t.max_age,p=t.ui_locales,f=t.id_token_hint,g=t.login_hint,_=t.acr_values,v=t.resource,m=t.response_mode,y=t.request,k=t.request_uri,b=t.extraQueryParams,S=t.request_type,w=t.client_secret,T=t.extraTokenParams,P=t.skipUserInfo;if(!r)throw s.error("SigninRequest.ctor: No url passed"),new Error("url");if(!n)throw s.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!i)throw s.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!o)throw s.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!a)throw s.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!u)throw s.error("SigninRequest.ctor: No authority passed"),new Error("authority");var R=e.isOidc(o),E=e.isCode(o);m||(m=e.isCode(o)?"query":null),this.state=new ae({nonce:R,data:c,client_id:n,authority:u,redirect_uri:i,code_verifier:E,request_type:S,response_mode:m,client_secret:w,scope:a,extraTokenParams:T,skipUserInfo:P}),r=Y.addQueryParam(r,"client_id",n),r=Y.addQueryParam(r,"redirect_uri",i),r=Y.addQueryParam(r,"response_type",o),r=Y.addQueryParam(r,"scope",a),r=Y.addQueryParam(r,"state",this.state.id),R&&(r=Y.addQueryParam(r,"nonce",this.state.nonce)),E&&(r=Y.addQueryParam(r,"code_challenge",this.state.code_challenge),r=Y.addQueryParam(r,"code_challenge_method","S256"));var U={prompt:d,display:l,max_age:h,ui_locales:p,id_token_hint:f,login_hint:g,acr_values:_,resource:v,request:y,request_uri:k,response_mode:m};for(var C in U)U[C]&&(r=Y.addQueryParam(r,C,U[C]));for(var x in b)r=Y.addQueryParam(r,x,b[x]);this.url=r}return e.isOidc=function e(t){return!!t.split(/\s+/g).filter((function(e){return"id_token"===e}))[0]},e.isOAuth=function e(t){return!!t.split(/\s+/g).filter((function(e){return"token"===e}))[0]},e.isCode=function e(t){return!!t.split(/\s+/g).filter((function(e){return"code"===e}))[0]},e}();function ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var de=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",r=Y.parseUrlFragment(e,t);this.error=r.error,this.error_description=r.error_description,this.error_uri=r.error_uri,this.code=r.code,this.state=r.state,this.id_token=r.id_token,this.session_state=r.session_state,this.access_token=r.access_token,this.token_type=r.token_type,this.scope=r.scope,this.profile=void 0,this.expires_in=r.expires_in}return function t(e,r,n){return r&&ce(e.prototype,r),n&&ce(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"expires_in",get:function e(){if(this.expires_at){var t=parseInt(Date.now()/1e3);return this.expires_at-t}},set:function e(t){var r=parseInt(t);if("number"==typeof r&&r>0){var n=parseInt(Date.now()/1e3);this.expires_at=n+r}}},{key:"expired",get:function e(){var t=this.expires_in;if(void 0!==t)return t<=0}},{key:"scopes",get:function e(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function e(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),e}(),le=function e(t){var r=t.url,n=t.id_token_hint,i=t.post_logout_redirect_uri,o=t.data,a=t.extraQueryParams,u=t.request_type;if(!r)throw s.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var c in n&&(r=Y.addQueryParam(r,"id_token_hint",n)),i&&(r=Y.addQueryParam(r,"post_logout_redirect_uri",i),o&&(this.state=new ie({data:o,request_type:u}),r=Y.addQueryParam(r,"state",this.state.id))),a)r=Y.addQueryParam(r,c,a[c]);this.url=r},he=function e(t){var r=Y.parseUrlFragment(t,"?");this.error=r.error,this.error_description=r.error_description,this.error_uri=r.error_uri,this.state=r.state};function pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fe=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._settings=e instanceof G?e:new G(e)}var t=e.prototype;return t.createSigninRequest=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.response_type,i=r.scope,o=r.redirect_uri,a=r.data,u=r.state,c=r.prompt,d=r.display,l=r.max_age,h=r.ui_locales,p=r.id_token_hint,f=r.login_hint,g=r.acr_values,_=r.resource,v=r.request,m=r.request_uri,y=r.response_mode,k=r.extraQueryParams,b=r.extraTokenParams,S=r.request_type,w=r.skipUserInfo,T=arguments.length>1?arguments[1]:void 0;s.debug("OidcClient.createSigninRequest");var P=this._settings.client_id;n=n||this._settings.response_type,i=i||this._settings.scope,o=o||this._settings.redirect_uri,c=c||this._settings.prompt,d=d||this._settings.display,l=l||this._settings.max_age,h=h||this._settings.ui_locales,g=g||this._settings.acr_values,_=_||this._settings.resource,y=y||this._settings.response_mode,k=k||this._settings.extraQueryParams,b=b||this._settings.extraTokenParams;var R=this._settings.authority;return ue.isCode(n)&&"code"!==n?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then((function(e){s.debug("OidcClient.createSigninRequest: Received authorization endpoint",e);var r=new ue({url:e,client_id:P,redirect_uri:o,response_type:n,scope:i,data:a||u,authority:R,prompt:c,display:d,max_age:l,ui_locales:h,id_token_hint:p,login_hint:f,acr_values:g,resource:_,request:v,request_uri:m,extraQueryParams:k,extraTokenParams:b,request_type:S,response_mode:y,client_secret:t._settings.client_secret,skipUserInfo:w}),E=r.state;return(T=T||t._stateStore).set(E.id,E.toStorageString()).then((function(){return r}))}))},t.readSigninResponseState=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s.debug("OidcClient.readSigninResponseState");var i="query"===this._settings.response_mode||!this._settings.response_mode&&ue.isCode(this._settings.response_type),o=i?"?":"#",a=new de(t,o);if(!a.state)return s.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));r=r||this._stateStore;var u=n?r.remove.bind(r):r.get.bind(r);return u(a.state).then((function(e){if(!e)throw s.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:ae.fromStorageString(e),response:a}}))},t.processSigninResponse=function e(t,r){var n=this;return s.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(t,r,!0).then((function(e){var t=e.state,r=e.response;return s.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),n._validator.validateSigninResponse(t,r)}))},t.createSignoutRequest=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.id_token_hint,i=r.data,o=r.state,a=r.post_logout_redirect_uri,u=r.extraQueryParams,c=r.request_type,d=arguments.length>1?arguments[1]:void 0;return s.debug("OidcClient.createSignoutRequest"),a=a||this._settings.post_logout_redirect_uri,u=u||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then((function(e){if(!e)throw s.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");s.debug("OidcClient.createSignoutRequest: Received end session endpoint",e);var r=new le({url:e,id_token_hint:n,post_logout_redirect_uri:a,data:i||o,extraQueryParams:u,request_type:c}),l=r.state;return l&&(s.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(d=d||t._stateStore).set(l.id,l.toStorageString())),r}))},t.readSignoutResponseState=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s.debug("OidcClient.readSignoutResponseState");var i=new he(t);if(!i.state)return s.debug("OidcClient.readSignoutResponseState: No state in response"),i.error?(s.warn("OidcClient.readSignoutResponseState: Response was error: ",i.error),Promise.reject(new V(i))):Promise.resolve({state:void 0,response:i});var o=i.state;r=r||this._stateStore;var a=n?r.remove.bind(r):r.get.bind(r);return a(o).then((function(e){if(!e)throw s.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:ie.fromStorageString(e),response:i}}))},t.processSignoutResponse=function e(t,r){var n=this;return s.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(t,r,!0).then((function(e){var t=e.state,r=e.response;return t?(s.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),n._validator.validateSignoutResponse(t,r)):(s.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),r)}))},t.clearStaleState=function e(t){return s.debug("OidcClient.clearStaleState"),t=t||this._stateStore,ie.clearStaleState(t,this.settings.staleStateAge)},function r(e,t,n){return t&&pe(e.prototype,t),n&&pe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"_stateStore",get:function e(){return this.settings.stateStore}},{key:"_validator",get:function e(){return this.settings.validator}},{key:"_metadataService",get:function e(){return this.settings.metadataService}},{key:"settings",get:function e(){return this._settings}},{key:"metadataService",get:function e(){return this._metadataService}}]),e}();function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _e=function(){function e(){this._data={}}var t=e.prototype;return t.getItem=function e(t){return s.debug("InMemoryWebStorage.getItem",t),this._data[t]},t.setItem=function e(t,r){s.debug("InMemoryWebStorage.setItem",t),this._data[t]=r},t.removeItem=function e(t){s.debug("InMemoryWebStorage.removeItem",t),delete this._data[t]},t.key=function e(t){return Object.getOwnPropertyNames(this._data)[t]},function r(e,t,n){return t&&ge(e.prototype,t),n&&ge(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"length",get:function e(){return Object.getOwnPropertyNames(this._data).length}}]),e}();function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var me=function(){function e(){}var t=e.prototype;return t.prepare=function e(){return Promise.resolve(this)},t.navigate=function e(t){return t&&t.url?(t.useReplaceToNavigate?window.location.replace(t.url):window.location=t.url,Promise.resolve()):(s.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},function r(e,t,n){return t&&ve(e.prototype,t),n&&ve(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"url",get:function e(){return window.location.href}}]),e}();function ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ke=function(){function e(e){var t=this;this._promise=new Promise((function(e,r){t._resolve=e,t._reject=r}));var r=e.popupWindowTarget||"_blank",n=e.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",r,n),this._popup&&(s.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}var t=e.prototype;return t.navigate=function e(t){return this._popup?t&&t.url?(s.debug("PopupWindow.navigate: Setting URL in popup"),this._id=t.id,this._id&&(window["popupCallback_"+t.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=t.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},t._success=function e(t){s.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(t)},t._error=function e(t){s.error("PopupWindow.error: ",t),this._cleanup(),this._reject(new Error(t))},t.close=function e(){this._cleanup(!1)},t._cleanup=function e(t){s.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!t&&this._popup.close(),this._popup=null},t._checkForPopupClosed=function e(){this._popup&&!this._popup.closed||this._error("Popup window closed")},t._callback=function e(t,r){this._cleanup(r),t?(s.debug("PopupWindow.callback success"),this._success({url:t})):(s.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},e.notifyOpener=function e(t,r,n){if(window.opener){if(t=t||window.location.href){var i=Y.parseUrlFragment(t,n);if(i.state){var o="popupCallback_"+i.state,a=window.opener[o];a?(s.debug("PopupWindow.notifyOpener: passing url message to opener"),a(t,r)):s.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else s.warn("PopupWindow.notifyOpener: no state found in response url")}}else s.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},function r(e,t,n){return t&&ye(e.prototype,t),n&&ye(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"promise",get:function e(){return this._promise}}]),e}(),be=function(){function e(){}var t=e.prototype;return t.prepare=function e(t){var r=new ke(t);return Promise.resolve(r)},t.callback=function e(t,r,n){s.debug("PopupNavigator.callback");try{return ke.notifyOpener(t,r,n),Promise.resolve()}catch(e){return Promise.reject(e)}},e}();function Se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var we=function(){function e(e){var t=this;this._promise=new Promise((function(e,r){t._resolve=e,t._reject=r})),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}var t=e.prototype;return t.navigate=function e(t){if(t&&t.url){var r=t.silentRequestTimeout||1e4;s.debug("IFrameWindow.navigate: Using timeout of:",r),this._timer=window.setTimeout(this._timeout.bind(this),r),this._frame.src=t.url}else this._error("No url provided");return this.promise},t._success=function e(t){this._cleanup(),s.debug("IFrameWindow: Successful response from frame window"),this._resolve(t)},t._error=function e(t){this._cleanup(),s.error(t),this._reject(new Error(t))},t.close=function e(){this._cleanup()},t._cleanup=function e(){this._frame&&(s.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},t._timeout=function e(){s.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},t._message=function e(t){if(s.debug("IFrameWindow.message"),this._timer&&t.origin===this._origin&&t.source===this._frame.contentWindow&&"string"==typeof t.data&&(t.data.startsWith("http://")||t.data.startsWith("https://"))){var r=t.data;r?this._success({url:r}):this._error("Invalid response from frame")}},e.notifyParent=function e(t){s.debug("IFrameWindow.notifyParent"),(t=t||window.location.href)&&(s.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(t,location.protocol+"//"+location.host))},function r(e,t,n){return t&&Se(e.prototype,t),n&&Se(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"promise",get:function e(){return this._promise}},{key:"_origin",get:function e(){return location.protocol+"//"+location.host}}]),e}(),Te=function(){function e(){}var t=e.prototype;return t.prepare=function e(t){var r=new we(t);return Promise.resolve(r)},t.callback=function e(t){s.debug("IFrameNavigator.callback");try{return we.notifyParent(t),Promise.resolve()}catch(e){return Promise.reject(e)}},e}();function Pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Re(e,t){return Re=Object.setPrototypeOf||function e(t,r){return t.__proto__=r,t},Re(e,t)}var Ee=function(e){function t(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.popup_redirect_uri,i=r.popup_post_logout_redirect_uri,o=r.popupWindowFeatures,s=r.popupWindowTarget,a=r.silent_redirect_uri,u=r.silentRequestTimeout,c=r.automaticSilentRenew,d=void 0!==c&&c,l=r.validateSubOnSilentRenew,f=void 0!==l&&l,g=r.includeIdTokenInSilentRenew,_=void 0===g||g,v=r.monitorSession,m=void 0===v||v,y=r.monitorAnonymousSession,k=void 0!==y&&y,b=r.checkSessionInterval,S=void 0===b?2e3:b,w=r.stopCheckSessionOnError,T=void 0===w||w,P=r.query_status_response_type,R=r.revokeAccessTokenOnSignout,E=void 0!==R&&R,U=r.accessTokenExpiringNotificationTime,C=void 0===U?60:U,x=r.redirectNavigator,I=void 0===x?new me:x,O=r.popupNavigator,M=void 0===O?new be:O,j=r.iframeNavigator,A=void 0===j?new Te:j,N=r.userStore,q=void 0===N?new p({store:h.sessionStorage}):N;return(t=e.call(this,arguments[0])||this)._popup_redirect_uri=n,t._popup_post_logout_redirect_uri=i,t._popupWindowFeatures=o,t._popupWindowTarget=s,t._silent_redirect_uri=a,t._silentRequestTimeout=u,t._automaticSilentRenew=d,t._validateSubOnSilentRenew=f,t._includeIdTokenInSilentRenew=_,t._accessTokenExpiringNotificationTime=C,t._monitorSession=m,t._monitorAnonymousSession=k,t._checkSessionInterval=S,t._stopCheckSessionOnError=T,P?t._query_status_response_type=P:arguments[0]&&arguments[0].response_type?t._query_status_response_type=ue.isOidc(arguments[0].response_type)?"id_token":"code":t._query_status_response_type="id_token",t._revokeAccessTokenOnSignout=E,t._redirectNavigator=I,t._popupNavigator=M,t._iframeNavigator=A,t._userStore=q,t}return function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Re(e,t)}(t,e),function n(e,t,r){return t&&Pe(e.prototype,t),r&&Pe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"popup_redirect_uri",get:function e(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function e(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function e(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function e(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function e(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function e(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function e(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function e(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function e(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function e(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function e(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function e(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function e(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function e(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function e(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function e(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function e(){return this._redirectNavigator}},{key:"popupNavigator",get:function e(){return this._popupNavigator}},{key:"iframeNavigator",get:function e(){return this._iframeNavigator}},{key:"userStore",get:function e(){return this._userStore}}]),t}(G);function Ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ce=function(){function e(e){var t=e.id_token,r=e.session_state,n=e.access_token,i=e.refresh_token,o=e.token_type,s=e.scope,a=e.profile,u=e.expires_at,c=e.state;this.id_token=t,this.session_state=r,this.access_token=n,this.refresh_token=i,this.token_type=o,this.scope=s,this.profile=a,this.expires_at=u,this.state=c}return e.prototype.toStorageString=function e(){return s.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},e.fromStorageString=function t(r){return s.debug("User.fromStorageString"),new e(JSON.parse(r))},function t(e,r,n){return r&&Ue(e.prototype,r),n&&Ue(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"expires_in",get:function e(){if(this.expires_at){var t=parseInt(Date.now()/1e3);return this.expires_at-t}},set:function e(t){var r=parseInt(t);if("number"==typeof r&&r>0){var n=parseInt(Date.now()/1e3);this.expires_at=n+r}}},{key:"expired",get:function e(){var t=this.expires_in;if(void 0!==t)return t<=0}},{key:"scopes",get:function e(){return(this.scope||"").split(" ")}}]),e}(),xe=function(){function e(e){this._name=e,this._callbacks=[]}var t=e.prototype;return t.addHandler=function e(t){this._callbacks.push(t)},t.removeHandler=function e(t){var r=this._callbacks.findIndex((function(e){return e===t}));r>=0&&this._callbacks.splice(r,1)},t.raise=function e(){s.debug("Event: Raising event: "+this._name);for(var t=0;t<this._callbacks.length;t++){var r;(r=this._callbacks)[t].apply(r,arguments)}},e}();function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Oe(e,t){return Oe=Object.setPrototypeOf||function e(t,r){return t.__proto__=r,t},Oe(e,t)}var Me=function(e){function t(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.timer,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(r=e.call(this,t)||this)._timer=n,r._nowFunc=i||function(){return Date.now()/1e3},r}!function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Oe(e,t)}(t,e);var n=t.prototype;return n.init=function e(t){t<=0&&(t=1),t=parseInt(t);var r=this.now+t;if(this.expiration===r&&this._timerHandle)s.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),s.debug("Timer.init timer "+this._name+" for duration:",t),this._expiration=r;var n=5;t<n&&(n=t),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*n)}},n.cancel=function e(){this._timerHandle&&(s.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},n._callback=function t(){var r=this._expiration-this.now;s.debug("Timer.callback; "+this._name+" timer expires in:",r),this._expiration<=this.now&&(this.cancel(),e.prototype.raise.call(this))},function i(e,t,r){return t&&Ie(e.prototype,t),r&&Ie(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"now",get:function e(){return parseInt(this._nowFunc())}},{key:"expiration",get:function e(){return this._expiration}}]),t}(xe),je=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.accessTokenExpiringNotificationTime,r=void 0===t?60:t,n=e.accessTokenExpiringTimer,i=void 0===n?new Me("Access token expiring"):n,o=e.accessTokenExpiredTimer,s=void 0===o?new Me("Access token expired"):o;this._accessTokenExpiringNotificationTime=r,this._accessTokenExpiring=i,this._accessTokenExpired=s}var t=e.prototype;return t.load=function e(t){if(t.access_token&&void 0!==t.expires_in){var r=t.expires_in;if(s.debug("AccessTokenEvents.load: access token present, remaining duration:",r),r>0){var n=r-this._accessTokenExpiringNotificationTime;n<=0&&(n=1),s.debug("AccessTokenEvents.load: registering expiring timer in:",n),this._accessTokenExpiring.init(n)}else s.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var i=r+1;s.debug("AccessTokenEvents.load: registering expired timer in:",i),this._accessTokenExpired.init(i)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},t.unload=function e(){s.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},t.addAccessTokenExpiring=function e(t){this._accessTokenExpiring.addHandler(t)},t.removeAccessTokenExpiring=function e(t){this._accessTokenExpiring.removeHandler(t)},t.addAccessTokenExpired=function e(t){this._accessTokenExpired.addHandler(t)},t.removeAccessTokenExpired=function e(t){this._accessTokenExpired.removeHandler(t)},e}();function Ae(e,t){return Ae=Object.setPrototypeOf||function e(t,r){return t.__proto__=r,t},Ae(e,t)}var Ne=function(e){function t(t){var r;return(r=e.call(this,t)||this)._userLoaded=new xe("User loaded"),r._userUnloaded=new xe("User unloaded"),r._silentRenewError=new xe("Silent renew error"),r._userSignedIn=new xe("User signed in"),r._userSignedOut=new xe("User signed out"),r._userSessionChanged=new xe("User session changed"),r}!function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ae(e,t)}(t,e);var n=t.prototype;return n.load=function t(r){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s.debug("UserManagerEvents.load"),e.prototype.load.call(this,r),n&&this._userLoaded.raise(r)},n.unload=function t(){s.debug("UserManagerEvents.unload"),e.prototype.unload.call(this),this._userUnloaded.raise()},n.addUserLoaded=function e(t){this._userLoaded.addHandler(t)},n.removeUserLoaded=function e(t){this._userLoaded.removeHandler(t)},n.addUserUnloaded=function e(t){this._userUnloaded.addHandler(t)},n.removeUserUnloaded=function e(t){this._userUnloaded.removeHandler(t)},n.addSilentRenewError=function e(t){this._silentRenewError.addHandler(t)},n.removeSilentRenewError=function e(t){this._silentRenewError.removeHandler(t)},n._raiseSilentRenewError=function e(t){s.debug("UserManagerEvents._raiseSilentRenewError",t.message),this._silentRenewError.raise(t)},n.addUserSignedIn=function e(t){this._userSignedIn.addHandler(t)},n.removeUserSignedIn=function e(t){this._userSignedIn.removeHandler(t)},n._raiseUserSignedIn=function e(){s.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},n.addUserSignedOut=function e(t){this._userSignedOut.addHandler(t)},n.removeUserSignedOut=function e(t){this._userSignedOut.removeHandler(t)},n._raiseUserSignedOut=function e(){s.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},n.addUserSessionChanged=function e(t){this._userSessionChanged.addHandler(t)},n.removeUserSessionChanged=function e(t){this._userSessionChanged.removeHandler(t)},n._raiseUserSessionChanged=function e(){s.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},t}(je),qe=function(){function e(e){this._userManager=e}var t=e.prototype;return t.start=function e(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then((function(e){})).catch((function(e){s.error("SilentRenewService.start: Error from getUser:",e.message)})))},t.stop=function e(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},t._tokenExpiring=function e(){var t=this;this._userManager.signinSilent().then((function(e){s.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")}),(function(e){s.error("SilentRenewService._tokenExpiring: Error from signinSilent:",e.message),t._userManager.events._raiseSilentRenewError(e)}))},e}(),Je=function(){function e(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._callback=e,this._client_id=t,this._url=r,this._interval=n||2e3,this._stopOnError=i;var o=r.indexOf("/",r.indexOf("//")+2);this._frame_origin=r.substr(0,o),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=r}var t=e.prototype;return t.load=function e(){var t=this;return new Promise((function(e){t._frame.onload=function(){e()},window.document.body.appendChild(t._frame),t._boundMessageEvent=t._message.bind(t),window.addEventListener("message",t._boundMessageEvent,!1)}))},t._message=function e(t){t.origin===this._frame_origin&&t.source===this._frame.contentWindow&&("error"===t.data?(s.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):"changed"===t.data?(s.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):s.debug("CheckSessionIFrame: "+t.data+" message from check session op iframe"))},t.start=function e(t){var r=this;if(this._session_state!==t){s.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=t;var n=function e(){r._frame.contentWindow.postMessage(r._client_id+" "+r._session_state,r._frame_origin)};n(),this._timer=window.setInterval(n,this._interval)}},t.stop=function e(){this._session_state=null,this._timer&&(s.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},e}();function Be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Fe=function(){function e(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Je,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.timer;if(!e)throw s.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=e,this._CheckSessionIFrameCtor=r,this._timer=n,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then((function(e){e?t._start(e):t._settings.monitorAnonymousSession&&t._userManager.querySessionStatus().then((function(e){var r={session_state:e.session_state};e.sub&&e.sid&&(r.profile={sub:e.sub,sid:e.sid}),t._start(r)})).catch((function(e){s.error("SessionMonitor ctor: error from querySessionStatus:",e.message)}))})).catch((function(e){s.error("SessionMonitor ctor: error from getUser:",e.message)})))}var t=e.prototype;return t._start=function e(t){var r=this,n=t.session_state;n&&(t.profile?(this._sub=t.profile.sub,this._sid=t.profile.sid,s.debug("SessionMonitor._start: session_state:",n,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,s.debug("SessionMonitor._start: session_state:",n,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(n):this._metadataService.getCheckSessionIframe().then((function(e){if(e){s.debug("SessionMonitor._start: Initializing check session iframe");var t=r._client_id,i=r._checkSessionInterval,o=r._stopCheckSessionOnError;r._checkSessionIFrame=new r._CheckSessionIFrameCtor(r._callback.bind(r),t,e,i,o),r._checkSessionIFrame.load().then((function(){r._checkSessionIFrame.start(n)}))}else s.warn("SessionMonitor._start: No check session iframe found in the metadata")})).catch((function(e){s.error("SessionMonitor._start: Error from getCheckSessionIframe:",e.message)})))},t._stop=function e(){var t=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(s.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var r=this._timer.setInterval((function(){t._timer.clearInterval(r),t._userManager.querySessionStatus().then((function(e){var r={session_state:e.session_state};e.sub&&e.sid&&(r.profile={sub:e.sub,sid:e.sid}),t._start(r)})).catch((function(e){s.error("SessionMonitor: error from querySessionStatus:",e.message)}))}),1e3)},t._callback=function e(){var t=this;this._userManager.querySessionStatus().then((function(e){var r=!0;e?e.sub===t._sub?(r=!1,t._checkSessionIFrame.start(e.session_state),e.sid===t._sid?s.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",e.session_state):(s.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",e.session_state),t._userManager.events._raiseUserSessionChanged())):s.debug("SessionMonitor._callback: Different subject signed into OP:",e.sub):s.debug("SessionMonitor._callback: Subject no longer signed into OP"),r&&(t._sub?(s.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),t._userManager.events._raiseUserSignedOut()):(s.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),t._userManager.events._raiseUserSignedIn()))})).catch((function(e){t._sub&&(s.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",e.message),t._userManager.events._raiseUserSignedOut())}))},function r(e,t,n){return t&&Be(e.prototype,t),n&&Be(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"_settings",get:function e(){return this._userManager.settings}},{key:"_metadataService",get:function e(){return this._userManager.metadataService}},{key:"_client_id",get:function e(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function e(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function e(){return this._settings.stopCheckSessionOnError}}]),e}(),Ve="access_token",De="refresh_token",We=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.XMLHttpRequest,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;if(!e)throw s.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=e,this._XMLHttpRequestCtor=t,this._metadataService=new r(this._settings)}var t=e.prototype;return t.revoke=function e(t,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"access_token";if(!t)throw s.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(i!==Ve&&i!=De)throw s.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then((function(e){if(e){s.debug("TokenRevocationClient.revoke: Revoking "+i);var o=n._settings.client_id,a=n._settings.client_secret;return n._revoke(e,o,a,t,i)}if(r)throw s.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")}))},t._revoke=function e(t,r,n,i,o){var a=this;return new Promise((function(e,u){var c=new a._XMLHttpRequestCtor;c.open("POST",t),c.onload=function(){s.debug("TokenRevocationClient.revoke: HTTP response received, status",c.status),200===c.status?e():u(Error(c.statusText+" ("+c.status+")"))},c.onerror=function(){s.debug("TokenRevocationClient.revoke: Network Error."),u("Network Error")};var d="client_id="+encodeURIComponent(r);n&&(d+="&client_secret="+encodeURIComponent(n)),d+="&token_type_hint="+encodeURIComponent(o),d+="&token="+encodeURIComponent(i),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(d)}))},e}();function He(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e,t){return ze=Object.setPrototypeOf||function e(t,r){return t.__proto__=r,t},ze(e,t)}var Ke=function(e){function t(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qe,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fe,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:We,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:I;return r instanceof Ee||(r=new Ee(r)),(t=e.call(this,r)||this)._events=new Ne(r),t._silentRenewService=new n(Le(t)),t.settings.automaticSilentRenew&&(s.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),t.startSilentRenew()),t.settings.monitorSession&&(s.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),t._sessionMonitor=new i(Le(t))),t._tokenRevocationClient=new o(t._settings),t._tokenClient=new a(t._settings),t._joseUtil=u,t}!function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ze(e,t)}(t,e);var n=t.prototype;return n.getUser=function e(){var t=this;return this._loadUser().then((function(e){return e?(s.info("UserManager.getUser: user loaded"),t._events.load(e,!1),e):(s.info("UserManager.getUser: user not found in storage"),null)}))},n.removeUser=function e(){var t=this;return this.storeUser(null).then((function(){s.info("UserManager.removeUser: user removed from storage"),t._events.unload()}))},n.signinRedirect=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=Object.assign({},t)).request_type="si:r";var r={useReplaceToNavigate:t.useReplaceToNavigate};return this._signinStart(t,this._redirectNavigator,r).then((function(){s.info("UserManager.signinRedirect: successful")}))},n.signinRedirectCallback=function e(t){return this._signinEnd(t||this._redirectNavigator.url).then((function(e){return e.profile&&e.profile.sub?s.info("UserManager.signinRedirectCallback: successful, signed in sub: ",e.profile.sub):s.info("UserManager.signinRedirectCallback: no sub"),e}))},n.signinPopup=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=Object.assign({},t)).request_type="si:p";var r=t.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return r?(t.redirect_uri=r,t.display="popup",this._signin(t,this._popupNavigator,{startUrl:r,popupWindowFeatures:t.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:t.popupWindowTarget||this.settings.popupWindowTarget}).then((function(e){return e&&(e.profile&&e.profile.sub?s.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",e.profile.sub):s.info("UserManager.signinPopup: no sub")),e}))):(s.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},n.signinPopupCallback=function e(t){return this._signinCallback(t,this._popupNavigator).then((function(e){return e&&(e.profile&&e.profile.sub?s.info("UserManager.signinPopupCallback: successful, signed in sub: ",e.profile.sub):s.info("UserManager.signinPopupCallback: no sub")),e})).catch((function(e){s.error("UserManager.signinPopupCallback error: "+e&&e.message)}))},n.signinSilent=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r=Object.assign({},r),this._loadUser().then((function(e){return e&&e.refresh_token?(r.refresh_token=e.refresh_token,t._useRefreshToken(r)):(r.request_type="si:s",r.id_token_hint=r.id_token_hint||t.settings.includeIdTokenInSilentRenew&&e&&e.id_token,e&&t._settings.validateSubOnSilentRenew&&(s.debug("UserManager.signinSilent, subject prior to silent renew: ",e.profile.sub),r.current_sub=e.profile.sub),t._signinSilentIframe(r))}))},n._useRefreshToken=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(r).then((function(e){return e?e.access_token?t._loadUser().then((function(r){if(r){var n=Promise.resolve();return e.id_token&&(n=t._validateIdTokenFromTokenRefreshToken(r.profile,e.id_token)),n.then((function(){return s.debug("UserManager._useRefreshToken: refresh token response success"),r.id_token=e.id_token||r.id_token,r.access_token=e.access_token,r.refresh_token=e.refresh_token||r.refresh_token,r.expires_in=e.expires_in,t.storeUser(r).then((function(){return t._events.load(r),r}))}))}return null})):(s.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(s.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))}))},n._validateIdTokenFromTokenRefreshToken=function e(t,r){var n=this;return this._metadataService.getIssuer().then((function(e){return n.settings.getEpochTime().then((function(i){return n._joseUtil.validateJwtAttributes(r,e,n._settings.client_id,n._settings.clockSkew,i).then((function(e){return e?e.sub!==t.sub?(s.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):e.auth_time&&e.auth_time!==t.auth_time?(s.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):e.azp&&e.azp!==t.azp?(s.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!e.azp&&t.azp?(s.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(s.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))}))}))}))},n._signinSilentIframe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return r?(t.redirect_uri=r,t.prompt=t.prompt||"none",this._signin(t,this._iframeNavigator,{startUrl:r,silentRequestTimeout:t.silentRequestTimeout||this.settings.silentRequestTimeout}).then((function(e){return e&&(e.profile&&e.profile.sub?s.info("UserManager.signinSilent: successful, signed in sub: ",e.profile.sub):s.info("UserManager.signinSilent: no sub")),e}))):(s.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},n.signinSilentCallback=function e(t){return this._signinCallback(t,this._iframeNavigator).then((function(e){return e&&(e.profile&&e.profile.sub?s.info("UserManager.signinSilentCallback: successful, signed in sub: ",e.profile.sub):s.info("UserManager.signinSilentCallback: no sub")),e}))},n.signinCallback=function e(t){var r=this;return this.readSigninResponseState(t).then((function(e){var n=e.state;e.response;return"si:r"===n.request_type?r.signinRedirectCallback(t):"si:p"===n.request_type?r.signinPopupCallback(t):"si:s"===n.request_type?r.signinSilentCallback(t):Promise.reject(new Error("invalid response_type in state"))}))},n.signoutCallback=function e(t,r){var n=this;return this.readSignoutResponseState(t).then((function(e){var i=e.state,o=e.response;return i?"so:r"===i.request_type?n.signoutRedirectCallback(t):"so:p"===i.request_type?n.signoutPopupCallback(t,r):Promise.reject(new Error("invalid response_type in state")):o}))},n.querySessionStatus=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(r=Object.assign({},r)).request_type="si:s";var n=r.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return n?(r.redirect_uri=n,r.prompt="none",r.response_type=r.response_type||this.settings.query_status_response_type,r.scope=r.scope||"openid",r.skipUserInfo=!0,this._signinStart(r,this._iframeNavigator,{startUrl:n,silentRequestTimeout:r.silentRequestTimeout||this.settings.silentRequestTimeout}).then((function(e){return t.processSigninResponse(e.url).then((function(e){if(s.debug("UserManager.querySessionStatus: got signin response"),e.session_state&&e.profile.sub)return s.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",e.profile.sub),{session_state:e.session_state,sub:e.profile.sub,sid:e.profile.sid};s.info("querySessionStatus successful, user not authenticated")})).catch((function(e){if(e.session_state&&t.settings.monitorAnonymousSession&&("login_required"==e.message||"consent_required"==e.message||"interaction_required"==e.message||"account_selection_required"==e.message))return s.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:e.session_state};throw e}))}))):(s.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},n._signin=function e(t,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._signinStart(t,r,i).then((function(e){return n._signinEnd(e.url,t)}))},n._signinStart=function e(t,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.prepare(i).then((function(e){return s.debug("UserManager._signinStart: got navigator window handle"),n.createSigninRequest(t).then((function(t){return s.debug("UserManager._signinStart: got signin request"),i.url=t.url,i.id=t.state.id,e.navigate(i)})).catch((function(t){throw e.close&&(s.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),e.close()),t}))}))},n._signinEnd=function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.processSigninResponse(t).then((function(e){s.debug("UserManager._signinEnd: got signin response");var t=new Ce(e);if(n.current_sub){if(n.current_sub!==t.profile.sub)return s.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",t.profile.sub),Promise.reject(new Error("login_required"));s.debug("UserManager._signinEnd: current user matches user returned from signin")}return r.storeUser(t).then((function(){return s.debug("UserManager._signinEnd: user stored"),r._events.load(t),t}))}))},n._signinCallback=function e(t,r){s.debug("UserManager._signinCallback");var n="query"===this._settings.response_mode||!this._settings.response_mode&&ue.isCode(this._settings.response_type)?"?":"#";return r.callback(t,void 0,n)},n.signoutRedirect=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=Object.assign({},t)).request_type="so:r";var r=t.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;r&&(t.post_logout_redirect_uri=r);var n={useReplaceToNavigate:t.useReplaceToNavigate};return this._signoutStart(t,this._redirectNavigator,n).then((function(){s.info("UserManager.signoutRedirect: successful")}))},n.signoutRedirectCallback=function e(t){return this._signoutEnd(t||this._redirectNavigator.url).then((function(e){return s.info("UserManager.signoutRedirectCallback: successful"),e}))},n.signoutPopup=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=Object.assign({},t)).request_type="so:p";var r=t.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return t.post_logout_redirect_uri=r,t.display="popup",t.post_logout_redirect_uri&&(t.state=t.state||{}),this._signout(t,this._popupNavigator,{startUrl:r,popupWindowFeatures:t.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:t.popupWindowTarget||this.settings.popupWindowTarget}).then((function(){s.info("UserManager.signoutPopup: successful")}))},n.signoutPopupCallback=function e(t,r){void 0===r&&"boolean"==typeof t&&(r=t,t=null);return this._popupNavigator.callback(t,r,"?").then((function(){s.info("UserManager.signoutPopupCallback: successful")}))},n._signout=function e(t,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._signoutStart(t,r,i).then((function(e){return n._signoutEnd(e.url)}))},n._signoutStart=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.prepare(i).then((function(e){return s.debug("UserManager._signoutStart: got navigator window handle"),t._loadUser().then((function(n){return s.debug("UserManager._signoutStart: loaded current user from storage"),(t._settings.revokeAccessTokenOnSignout?t._revokeInternal(n):Promise.resolve()).then((function(){var o=r.id_token_hint||n&&n.id_token;return o&&(s.debug("UserManager._signoutStart: Setting id_token into signout request"),r.id_token_hint=o),t.removeUser().then((function(){return s.debug("UserManager._signoutStart: user removed, creating signout request"),t.createSignoutRequest(r).then((function(t){return s.debug("UserManager._signoutStart: got signout request"),i.url=t.url,t.state&&(i.id=t.state.id),e.navigate(i)}))}))}))})).catch((function(t){throw e.close&&(s.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),e.close()),t}))}))},n._signoutEnd=function e(t){return this.processSignoutResponse(t).then((function(e){return s.debug("UserManager._signoutEnd: got signout response"),e}))},n.revokeAccessToken=function e(){var t=this;return this._loadUser().then((function(e){return t._revokeInternal(e,!0).then((function(r){if(r)return s.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),e.access_token=null,e.refresh_token=null,e.expires_at=null,e.token_type=null,t.storeUser(e).then((function(){s.debug("UserManager.revokeAccessToken: user stored"),t._events.load(e)}))}))})).then((function(){s.info("UserManager.revokeAccessToken: access token revoked successfully")}))},n._revokeInternal=function e(t,r){var n=this;if(t){var i=t.access_token,o=t.refresh_token;return this._revokeAccessTokenInternal(i,r).then((function(e){return n._revokeRefreshTokenInternal(o,r).then((function(t){return e||t||s.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),e||t}))}))}return Promise.resolve(!1)},n._revokeAccessTokenInternal=function e(t,r){return!t||t.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(t,r).then((function(){return!0}))},n._revokeRefreshTokenInternal=function e(t,r){return t?this._tokenRevocationClient.revoke(t,r,"refresh_token").then((function(){return!0})):Promise.resolve(!1)},n.startSilentRenew=function e(){this._silentRenewService.start()},n.stopSilentRenew=function e(){this._silentRenewService.stop()},n._loadUser=function e(){return this._userStore.get(this._userStoreKey).then((function(e){return e?(s.debug("UserManager._loadUser: user storageString loaded"),Ce.fromStorageString(e)):(s.debug("UserManager._loadUser: no user storageString"),null)}))},n.storeUser=function e(t){if(t){s.debug("UserManager.storeUser: storing user");var r=t.toStorageString();return this._userStore.set(this._userStoreKey,r)}return s.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},function i(e,t,r){return t&&He(e.prototype,t),r&&He(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"_redirectNavigator",get:function e(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function e(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function e(){return this.settings.iframeNavigator}},{key:"_userStore",get:function e(){return this.settings.userStore}},{key:"events",get:function e(){return this._events}},{key:"_userStoreKey",get:function e(){return"user:".concat(this.settings.authority,":").concat(this.settings.client_id)}}]),t}(fe);function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Xe=function(){function e(e){var t=this;this._promise=new Promise((function(e,r){t._resolve=e,t._reject=r})),this.features=e.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=e.popupWindowTarget||"_blank",this.redirect_uri=e.startUrl,s.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}var t=e.prototype;return t._isInAppBrowserInstalled=function e(t){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some((function(e){return t.hasOwnProperty(e)}))},t.navigate=function e(t){if(t&&t.url){if(!window.cordova)return this._error("cordova is undefined");var r=window.cordova.require("cordova/plugin_list").metadata;if(!1===this._isInAppBrowserInstalled(r))return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(t.url,this.target,this.features),this._popup?(s.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},t._loadStartCallback=function e(t){0===t.url.indexOf(this.redirect_uri)&&this._success({url:t.url})},t._exitCallback=function e(t){this._error(t)},t._success=function e(t){this._cleanup(),s.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(t)},t._error=function e(t){this._cleanup(),s.error(t),this._reject(new Error(t))},t.close=function e(){this._cleanup()},t._cleanup=function e(){this._popup&&(s.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},function r(e,t,n){return t&&Qe(e.prototype,t),n&&Qe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"promise",get:function e(){return this._promise}}]),e}();const Ze={Version:"1.11.6-beta.1",Log:s,OidcClient:fe,OidcClientSettings:G,WebStorageStateStore:p,InMemoryWebStorage:_e,UserManager:Ke,AccessTokenEvents:je,MetadataService:v,CordovaPopupNavigator:function(){function e(){}return e.prototype.prepare=function e(t){var r=new Xe(t);return Promise.resolve(r)},e}(),CordovaIFrameNavigator:function(){function e(){}return e.prototype.prepare=function e(t){t.popupWindowFeatures="hidden=yes";var r=new Xe(t);return Promise.resolve(r)},e}(),CheckSessionIFrame:Je,TokenRevocationClient:We,SessionMonitor:Fe,Global:h,User:Ce}})(),n})()}));